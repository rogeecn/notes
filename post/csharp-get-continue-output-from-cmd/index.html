<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>c#从命令中获取输出实时显示在控件中 - Rogee's 备忘录</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="Rogee"><meta name=description content="A brief description of what the code performs in this example: The shell command (cmd.exe) is run first, using start /WAIT as parameter. More or less the same functionality as /k : the console is started without any specific task, waiting to process a command when one is sent. StandardOutput, StandardError and StandardInput are all redirected, setting RedirectStandardOutput, RedirectStandardError and RedirectStandardInput properties of the ProcessStartInfo to true. The console Output"><meta name=keywords content="备忘录,Rogee,烂笔头">
<meta name=generator content="Hugo 0.89.4 with theme even">
<link rel=canonical href=http://notes.711xd.com/post/csharp-get-continue-output-from-cmd/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<meta property="og:title" content="c#从命令中获取输出实时显示在控件中 ">
<meta property="og:description" content="A brief description of what the code performs in this example: The shell command (cmd.exe) is run first, using start /WAIT as parameter. More or less the same functionality as /k : the console is started without any specific task, waiting to process a command when one is sent. StandardOutput, StandardError and StandardInput are all redirected, setting RedirectStandardOutput, RedirectStandardError and RedirectStandardInput properties of the ProcessStartInfo to true. The console Output">
<meta property="og:type" content="article">
<meta property="og:url" content="http://notes.711xd.com/post/csharp-get-continue-output-from-cmd/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-12-09T10:58:02+08:00">
<meta property="article:modified_time" content="2021-12-09T11:22:08+08:00">
<meta itemprop=name content="c#从命令中获取输出实时显示在控件中 ">
<meta itemprop=description content="A brief description of what the code performs in this example: The shell command (cmd.exe) is run first, using start /WAIT as parameter. More or less the same functionality as /k : the console is started without any specific task, waiting to process a command when one is sent. StandardOutput, StandardError and StandardInput are all redirected, setting RedirectStandardOutput, RedirectStandardError and RedirectStandardInput properties of the ProcessStartInfo to true. The console Output"><meta itemprop=datePublished content="2021-12-09T10:58:02+08:00">
<meta itemprop=dateModified content="2021-12-09T11:22:08+08:00">
<meta itemprop=wordCount content="766">
<meta itemprop=keywords content="C#,WinForms,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="c#从命令中获取输出实时显示在控件中 ">
<meta name=twitter:description content="A brief description of what the code performs in this example: The shell command (cmd.exe) is run first, using start /WAIT as parameter. More or less the same functionality as /k : the console is started without any specific task, waiting to process a command when one is sent. StandardOutput, StandardError and StandardInput are all redirected, setting RedirectStandardOutput, RedirectStandardError and RedirectStandardInput properties of the ProcessStartInfo to true. The console Output"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Rogee's 备忘录</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>首页</li>
</a><a href=/post/>
<li class=mobile-menu-item>归档</li>
</a><a href=/tags/>
<li class=mobile-menu-item>标签</li>
</a><a href=/categories/>
<li class=mobile-menu-item>分类</li>
</a><a href=/about/>
<li class=mobile-menu-item>关于</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>Rogee's 备忘录</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>首页</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>归档</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>标签</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>分类</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/>关于</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>c#从命令中获取输出实时显示在控件中 </h1>
<div class=post-meta>
<span class=post-time> 2021-12-09 </span>
<span id=busuanzi_container_page_pv class=more-meta> <span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次阅读 </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents></nav>
</div>
</div>
<div class=post-content>
<p>A brief description of what the code performs in this example:</p>
<p>The shell command (cmd.exe) is run first, using <code>start /WAIT</code> as parameter. More or less the same functionality as <code>/k</code> : the console is started without any specific task, waiting to process a command when one is sent.</p>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.standardoutput?view=netframework-4.7.2#System_Diagnostics_Process_StandardOutput">StandardOutput</a>, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.standarderror?view=netframework-4.7.2#System_Diagnostics_Process_StandardError">StandardError</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.standardinput?view=net-6.0">StandardInput</a> are all redirected, setting <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.processstartinfo.redirectstandardoutput?view=net-6.0">RedirectStandardOutput</a>, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.processstartinfo.redirectstandarderror?view=net-6.0">RedirectStandardError</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.processstartinfo.redirectstandardinput?view=net-6.0">RedirectStandardInput</a> properties of the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.processstartinfo?view=net-6.0">ProcessStartInfo</a> to true.</p>
<p>The console Output stream, when written to, will raise the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.outputdatareceived?view=net-6.0">OutputDataReceived</a> event; it&rsquo;s content can be read from the e.Data member of the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.datareceivedeventargs?view=net-6.0">DataReceivedEventArgs</a>.
StandardError will use its ErrorDataReceived event for the same purpose.
You could use a single event handler for both the events, but, after some testing, you might realize that is probably not a good idea. Having them separated avoids some weird overlapping and allows to easily tell apart errors from normal output (as a note, you can find programs that write to the error Stream instead of the output Stream).</p>
<p><code>StandardInput</code> can be redirected assigning it to a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.streamwriter?view=net-6.0">StreamWriter</a> stream.
Each time a string is written to the stream, the console will interpret that input as a command to be executed.</p>
<p>Also, the Process is instructed to rise it&rsquo;s Exited event upon termination, setting its <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.enableraisingevents?view=net-6.0">EnableRaisingEvents</a> property to true.
The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.exited?view=net-6.0">Exited</a> event is raised when the Process is closed because an Exit command is processed or calling the .<a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.close?view=net-6.0">Close()</a> method (or, eventually, the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.kill?view=net-6.0">.Kill()</a> method, which should only be used when a Process is not responding anymore, for some reason).</p>
<p>Since we need to pass the console Output to some UI controls (RichTextBoxes in this example) and the Process events are raised in ThreadPool Threads, we must synchronize this context with the UI&rsquo;s.
This can be done using the Process <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process.synchronizingobject?view=net-6.0">SynchronizingObject</a> property, setting it to the Parent Form or using the <a href=https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.control.begininvoke>Control.BeginInvoke</a> method, that will execute a delegate function on the thread where the control&rsquo;s handle belongs.
Here, a <a href=https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.methodinvoker>MethodInvoker</a> representing the delegate is used for this purpose.</p>
<p>The core function used to instantiate the Process and set its properties and event handlers:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
<span class=k>using</span> <span class=nn>System.Diagnostics</span><span class=p>;</span>
<span class=k>using</span> <span class=nn>System.IO</span><span class=p>;</span>
<span class=k>using</span> <span class=nn>System.Windows.Forms</span><span class=p>;</span>

<span class=k>public</span> <span class=k>partial</span> <span class=k>class</span> <span class=nc>frmCmdInOut</span> <span class=p>:</span> <span class=n>Form</span>
<span class=p>{</span>
    <span class=n>Process</span> <span class=n>cmdProcess</span> <span class=p>=</span> <span class=k>null</span><span class=p>;</span>
    <span class=n>StreamWriter</span> <span class=n>stdin</span> <span class=p>=</span> <span class=k>null</span><span class=p>;</span>

    <span class=k>public</span> <span class=n>frmCmdInOut</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=n>InitializeComponent</span><span class=p>();</span>

    <span class=k>private</span> <span class=k>void</span> <span class=n>MainForm_Load</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>rtbStdIn</span><span class=p>.</span><span class=n>Multiline</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
        <span class=n>rtbStdIn</span><span class=p>.</span><span class=n>SelectionIndent</span> <span class=p>=</span> <span class=m>20</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=k>void</span> <span class=n>btnStartProcess_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>btnStartProcess</span><span class=p>.</span><span class=n>Enabled</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
        <span class=n>StartCmdProcess</span><span class=p>();</span>
        <span class=n>btnEndProcess</span><span class=p>.</span><span class=n>Enabled</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=k>void</span> <span class=n>btnEndProcess_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>stdin</span><span class=p>.</span><span class=n>BaseStream</span><span class=p>.</span><span class=n>CanWrite</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>stdin</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>&#34;exit&#34;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>btnEndProcess</span><span class=p>.</span><span class=n>Enabled</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
        <span class=n>btnStartProcess</span><span class=p>.</span><span class=n>Enabled</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
        <span class=n>cmdProcess</span><span class=p>?.</span><span class=n>Close</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=k>void</span> <span class=n>rtbStdIn_KeyPress</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>KeyPressEventArgs</span> <span class=n>e</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>KeyChar</span> <span class=p>==</span> <span class=p>(</span><span class=kt>char</span><span class=p>)</span><span class=n>Keys</span><span class=p>.</span><span class=n>Enter</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>stdin</span> <span class=p>==</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>rtbStdErr</span><span class=p>.</span><span class=n>AppendText</span><span class=p>(</span><span class=s>&#34;Process not started&#34;</span> <span class=p>+</span> <span class=n>Environment</span><span class=p>.</span><span class=n>NewLine</span><span class=p>);</span>
                <span class=k>return</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=n>e</span><span class=p>.</span><span class=n>Handled</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>stdin</span><span class=p>.</span><span class=n>BaseStream</span><span class=p>.</span><span class=n>CanWrite</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>stdin</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>rtbStdIn</span><span class=p>.</span><span class=n>Text</span> <span class=p>+</span> <span class=n>Environment</span><span class=p>.</span><span class=n>NewLine</span><span class=p>);</span>
                <span class=n>stdin</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>();</span>
                <span class=c1>// To write to a Console app, just 
</span><span class=c1></span>                <span class=c1>// stdin.WriteLine(rtbStdIn.Text); 
</span><span class=c1></span>            <span class=p>}</span>
            <span class=n>rtbStdIn</span><span class=p>.</span><span class=n>Clear</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>private</span> <span class=k>void</span> <span class=n>StartCmdProcess</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>var</span> <span class=n>pStartInfo</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ProcessStartInfo</span> <span class=p>{</span>
             <span class=n>FileName</span> <span class=p>=</span> <span class=s>&#34;cmd.exe&#34;</span><span class=p>,</span> 
            <span class=c1>// Batch File Arguments = &#34;/C START /b /WAIT somebatch.bat&#34;, 
</span><span class=c1></span>            <span class=c1>// Test: Arguments = &#34;START /WAIT /K ipconfig /all&#34;, 
</span><span class=c1></span>            <span class=n>Arguments</span> <span class=p>=</span> <span class=s>&#34;START /WAIT&#34;</span><span class=p>,</span> 
            <span class=n>WorkingDirectory</span> <span class=p>=</span> <span class=n>Environment</span><span class=p>.</span><span class=n>SystemDirectory</span><span class=p>,</span> 
            <span class=c1>// WorkingDirectory = Application.StartupPath, 
</span><span class=c1></span>            <span class=n>RedirectStandardOutput</span> <span class=p>=</span> <span class=k>true</span><span class=p>,</span> 
            <span class=n>RedirectStandardError</span> <span class=p>=</span> <span class=k>true</span><span class=p>,</span> 
            <span class=n>RedirectStandardInput</span> <span class=p>=</span> <span class=k>true</span><span class=p>,</span> 
            <span class=n>UseShellExecute</span> <span class=p>=</span> <span class=k>false</span><span class=p>,</span> 
            <span class=n>CreateNoWindow</span> <span class=p>=</span> <span class=k>true</span><span class=p>,</span> 
            <span class=n>WindowStyle</span> <span class=p>=</span> <span class=n>ProcessWindowStyle</span><span class=p>.</span><span class=n>Hidden</span><span class=p>,</span> 
        <span class=p>};</span>

        <span class=n>cmdProcess</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Process</span> <span class=p>{</span>
            <span class=n>StartInfo</span> <span class=p>=</span> <span class=n>pStartInfo</span><span class=p>,</span> 
            <span class=n>EnableRaisingEvents</span> <span class=p>=</span> <span class=k>true</span><span class=p>,</span> 
            <span class=c1>// Test without and with this
</span><span class=c1></span>            <span class=c1>// When SynchronizingObject is set, no need to BeginInvoke()
</span><span class=c1></span>            <span class=c1>//SynchronizingObject = this
</span><span class=c1></span>        <span class=p>};</span>

        <span class=n>cmdProcess</span><span class=p>.</span><span class=n>Start</span><span class=p>();</span>
        <span class=n>cmdProcess</span><span class=p>.</span><span class=n>BeginErrorReadLine</span><span class=p>();</span>
        <span class=n>cmdProcess</span><span class=p>.</span><span class=n>BeginOutputReadLine</span><span class=p>();</span>
        <span class=n>stdin</span> <span class=p>=</span> <span class=n>cmdProcess</span><span class=p>.</span><span class=n>StandardInput</span><span class=p>;</span>
        <span class=c1>// stdin.AutoFlush = true;  &lt;- already true
</span><span class=c1></span>
        <span class=n>cmdProcess</span><span class=p>.</span><span class=n>OutputDataReceived</span> <span class=p>+=</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>evt</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>evt</span><span class=p>.</span><span class=n>Data</span> <span class=p>!=</span> <span class=k>null</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=n>BeginInvoke</span><span class=p>(</span><span class=k>new</span> <span class=n>MethodInvoker</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
                    <span class=n>rtbStdOut</span><span class=p>.</span><span class=n>AppendText</span><span class=p>(</span><span class=n>evt</span><span class=p>.</span><span class=n>Data</span> <span class=p>+</span> <span class=n>Environment</span><span class=p>.</span><span class=n>NewLine</span><span class=p>);</span>
                    <span class=n>rtbStdOut</span><span class=p>.</span><span class=n>ScrollToCaret</span><span class=p>();</span>
                <span class=p>}));</span>
            <span class=p>}</span>
        <span class=p>};</span>

        <span class=n>cmdProcess</span><span class=p>.</span><span class=n>ErrorDataReceived</span> <span class=p>+=</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>evt</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>evt</span><span class=p>.</span><span class=n>Data</span> <span class=p>!=</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>BeginInvoke</span><span class=p>(</span><span class=k>new</span> <span class=n>Action</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
                    <span class=n>rtbStdErr</span><span class=p>.</span><span class=n>AppendText</span><span class=p>(</span><span class=n>evt</span><span class=p>.</span><span class=n>Data</span> <span class=p>+</span> <span class=n>Environment</span><span class=p>.</span><span class=n>NewLine</span><span class=p>);</span>
                    <span class=n>rtbStdErr</span><span class=p>.</span><span class=n>ScrollToCaret</span><span class=p>();</span>
                <span class=p>}));</span>
            <span class=p>}</span>
        <span class=p>};</span>

        <span class=n>cmdProcess</span><span class=p>.</span><span class=n>Exited</span> <span class=p>+=</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>evt</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
            <span class=n>stdin</span><span class=p>?.</span><span class=n>Dispose</span><span class=p>();</span>
            <span class=n>cmdProcess</span><span class=p>?.</span><span class=n>Dispose</span><span class=p>();</span>
        <span class=p>};</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>Since the StandardInput has been redirected to a StreamWriter:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=n>stdin</span> <span class=p>=</span> <span class=n>cmdProcess</span><span class=p>.</span><span class=n>StandardInput</span><span class=p>;</span>
</code></pre></td></tr></table>
</div>
</div><p>we just write to the Stream to execute a command:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=n>stdin</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>([</span><span class=s>&#34;Command Text&#34;</span><span class=p>]);</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>From: <a href=https://stackoverflow.com/questions/51680382/how-do-i-get-output-from-a-command-to-appear-in-a-control-on-a-form-in-real-time>https://stackoverflow.com/questions/51680382/how-do-i-get-output-from-a-command-to-appear-in-a-control-on-a-form-in-real-time</a></p>
</blockquote>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>Rogee</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2021-12-09
<a href=https://github.com/rogeecn/notes/commit/2143e4750050b790debede32ce8842a6eb1df66a title="fix title">(2143e47)</a>
</span>
</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/c/>C#</a>
<a href=/tags/winforms/>WinForms</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/paralles-tnt-16-no-internet/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Paralles Tnt 16 No Internet</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/docker-image-with-steps/>
<span class="next-text nav-default">分阶段构建 Docker 镜像</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<div id=gitalk-container></div>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css crossorigin=anonymous>
<script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js crossorigin=anonymous></script>
<script type=text/javascript>var gitalk=new Gitalk({id:'2021-12-09 10:58:02 \u002b0800 \u002b0800',title:'c#从命令中获取输出实时显示在控件中 ',clientID:'a76a97e7cc23e0e0b81c',clientSecret:'c2b70fdf4690b743838e85e01d904249470079c8',repo:'notes',owner:'rogeecn',admin:['rogeecn'],body:decodeURI(location.href)});gitalk.render('gitalk-container')</script>
<noscript>Please enable JavaScript to view the <a href=https://github.com/gitalk/gitalk>comments powered by gitalk.</a></noscript>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://github.com/rogeecn class="iconfont icon-github" title=github></a>
<a href=http://notes.711xd.com/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span>
<span class=division>|</span>
<span class=theme-info>
主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<div class=busuanzi-footer>
<span id=busuanzi_container_site_pv> 本站总访问量 <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次 </span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv> 本站总访客数 <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> 人 </span>
</div>
<span class=copyright-year>
&copy;
2020 -
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>Rogee</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
</body>
</html>