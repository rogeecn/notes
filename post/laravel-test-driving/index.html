<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>简单的 11 步在 Laravel 中实现测试驱动开发  - Rogee's 备忘录</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="Rogee"><meta name=description content="测试驱动开发（英语：Test-driven development，缩写为 TDD）是一种软件开发过程中的应用方法，由极限编程中倡导，以其倡导先写测试程序，然后编码实现其功能得名。
下文是我在 Medium 上看到的一篇文章讲述了如何在 Laravel 中实现测试驱动开发，我自己已经在项目中实现了测试驱动开发，并且通过持续集成完成了项目的自动测试，文章中有些我认为需要改进的地方也注明了，希望这篇文章能帮助到那些想写测试用例但是一直觉得无从下手的开发者们。文章一共有四篇，之后计划都翻译出来给大家参考。
原文链接: https://medium.com/@jsdecena/simple-tdd-in&amp;hellip;
"><meta name=keywords content="备忘录,Rogee,烂笔头">
<meta name=generator content="Hugo 0.89.4 with theme even">
<link rel=canonical href=http://notes.711xd.com/post/laravel-test-driving/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<meta property="og:title" content="简单的 11 步在 Laravel 中实现测试驱动开发 ">
<meta property="og:description" content="测试驱动开发（英语：Test-driven development，缩写为 TDD）是一种软件开发过程中的应用方法，由极限编程中倡导，以其倡导先写测试程序，然后编码实现其功能得名。
下文是我在 Medium 上看到的一篇文章讲述了如何在 Laravel 中实现测试驱动开发，我自己已经在项目中实现了测试驱动开发，并且通过持续集成完成了项目的自动测试，文章中有些我认为需要改进的地方也注明了，希望这篇文章能帮助到那些想写测试用例但是一直觉得无从下手的开发者们。文章一共有四篇，之后计划都翻译出来给大家参考。
原文链接: https://medium.com/@jsdecena/simple-tdd-in&mldr;">
<meta property="og:type" content="article">
<meta property="og:url" content="http://notes.711xd.com/post/laravel-test-driving/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-11-26T16:19:29+08:00">
<meta property="article:modified_time" content="2021-11-26T16:31:21+08:00">
<meta itemprop=name content="简单的 11 步在 Laravel 中实现测试驱动开发 ">
<meta itemprop=description content="测试驱动开发（英语：Test-driven development，缩写为 TDD）是一种软件开发过程中的应用方法，由极限编程中倡导，以其倡导先写测试程序，然后编码实现其功能得名。
下文是我在 Medium 上看到的一篇文章讲述了如何在 Laravel 中实现测试驱动开发，我自己已经在项目中实现了测试驱动开发，并且通过持续集成完成了项目的自动测试，文章中有些我认为需要改进的地方也注明了，希望这篇文章能帮助到那些想写测试用例但是一直觉得无从下手的开发者们。文章一共有四篇，之后计划都翻译出来给大家参考。
原文链接: https://medium.com/@jsdecena/simple-tdd-in&mldr;"><meta itemprop=datePublished content="2021-11-26T16:19:29+08:00">
<meta itemprop=dateModified content="2021-11-26T16:31:21+08:00">
<meta itemprop=wordCount content="3470">
<meta itemprop=keywords content="Laravel,Testing,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="简单的 11 步在 Laravel 中实现测试驱动开发 ">
<meta name=twitter:description content="测试驱动开发（英语：Test-driven development，缩写为 TDD）是一种软件开发过程中的应用方法，由极限编程中倡导，以其倡导先写测试程序，然后编码实现其功能得名。
下文是我在 Medium 上看到的一篇文章讲述了如何在 Laravel 中实现测试驱动开发，我自己已经在项目中实现了测试驱动开发，并且通过持续集成完成了项目的自动测试，文章中有些我认为需要改进的地方也注明了，希望这篇文章能帮助到那些想写测试用例但是一直觉得无从下手的开发者们。文章一共有四篇，之后计划都翻译出来给大家参考。
原文链接: https://medium.com/@jsdecena/simple-tdd-in&mldr;"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Rogee's 备忘录</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>首页</li>
</a><a href=/post/>
<li class=mobile-menu-item>归档</li>
</a><a href=/tags/>
<li class=mobile-menu-item>标签</li>
</a><a href=/categories/>
<li class=mobile-menu-item>分类</li>
</a><a href=/about/>
<li class=mobile-menu-item>关于</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>Rogee's 备忘录</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>首页</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>归档</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>标签</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>分类</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/>关于</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>简单的 11 步在 Laravel 中实现测试驱动开发 </h1>
<div class=post-meta>
<span class=post-time> 2021-11-26 </span>
<span id=busuanzi_container_page_pv class=more-meta> <span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次阅读 </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href=#前言>前言</a></li>
<li><a href=#step-1-准备-laravel-测试套件>step 1: 准备 Laravel 测试套件</a></li>
<li><a href=#step2写测试用例>Step2：写测试用例</a></li>
<li><a href=#step-3-在路由文件中创建测试里请求的-url>Step 3: 在路由文件中创建测试里请求的 URL</a></li>
<li><a href=#step-4-debug-控制器>Step 4: DEBUG 控制器</a></li>
<li><a href=#step-5-验证你的输入>Step 5: 验证你的输入</a></li>
<li><a href=#step-6-返回刚才创建的数据>Step 6: 返回刚才创建的数据</a></li>
<li><a href=#step-7-创建模型类>Step 7: 创建模型类</a></li>
<li><a href=#step-8-再次执行-phpunit-看看结果会怎么样135f2d>Step 8: 再次执行 phpunit 看看结果会怎么样<a href=#135f2d>#</a></a></li>
<li><a href=#step-9-创建数据表>Step 9: 创建数据表</a></li>
<li><a href=#step-10-再一次运行-phpunit>Step 10: 再一次运行 phpunit</a></li>
<li><a href=#step-11-运行-phpunit-然后祈祷一切会好b82507>Step 11: 运行 phpunit 然后祈祷一切会好<a href=#b82507>#</a></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p><strong>测试驱动开发</strong>（英语：Test-driven development，缩写为 TDD）是一种<a href=https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B>软件开发过程</a>中的应用方法，由<a href=https://zh.wikipedia.org/wiki/%E6%9E%81%E9%99%90%E7%BC%96%E7%A8%8B>极限编程</a>中倡导，以其倡导先写测试程序，然后编码实现其功能得名。</p>
<p>下文是我在 Medium 上看到的一篇文章讲述了如何在 Laravel 中实现测试驱动开发，我自己已经在项目中实现了测试驱动开发，并且通过持续集成完成了项目的自动测试，文章中有些我认为需要改进的地方也注明了，希望这篇文章能帮助到那些想写测试用例但是一直觉得无从下手的开发者们。文章一共有四篇，之后计划都翻译出来给大家参考。</p>
<p>原文链接: <a href=https://medium.com/@jsdecena/simple-tdd-in-laravel-with-11-steps-c475f8b1b214>https://medium.com/@jsdecena/simple-tdd-in&mldr;</a></p>
<h3 id=前言>前言</h3>
<p>大多数 Web 开发工程师第一次听到 TTD (test driven development) 测试驱动开发的时候都会感到畏惧，我也一样。当你刚开始试着进行测试驱动开发时你会感到很崩溃，但是如果你抗拒它就很难真正学会并掌握它。在本文中我会介绍如何在 Laravel 中进行测试驱动开发。</p>
<blockquote>
<p>Note: 这篇文章时针对 API 响应的 TDD. 如果你想看与 Laravel blade 相关的功能测试请看这篇文章 (还未来得及翻译，访问需要科学上网), <a href=https://medium.com/@jsdecena/crud-feature-testing-in-laravel-5-865b7532439>head up on this article.</a></p>
</blockquote>
<h3 id=step-1-准备-laravel-测试套件>step 1: 准备 Laravel 测试套件</h3>
<p>在项目根目录中，更新 <code>phpunit.xml</code> 文件的如下项目:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;DB_CONNECTION&#34;</span> <span class=na>value=</span><span class=s>&#34;sqlite&#34;</span><span class=nt>/&gt;</span>
<span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;DB_DATABASE&#34;</span> <span class=na>value=</span><span class=s>&#34;:memory:&#34;</span><span class=nt>/&gt;</span>
<span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;API_DEBUG&#34;</span> <span class=na>value=</span><span class=s>&#34;false&#34;</span><span class=nt>/&gt;</span>
<span class=nt>&lt;ini</span> <span class=na>name=</span><span class=s>&#34;memory_limit&#34;</span> <span class=na>value=</span><span class=s>&#34;512M&#34;</span> <span class=nt>/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>更新完后 <code>phpunit.xml</code> 文件会像下面这样:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>

<span class=nt>&lt;phpunit</span> <span class=na>backupGlobals=</span><span class=s>&#34;false&#34;</span>
  <span class=na>backupStaticAttributes=</span><span class=s>&#34;false&#34;</span>
  <span class=na>bootstrap=</span><span class=s>&#34;vendor/autoload.php&#34;</span>
  <span class=na>colors=</span><span class=s>&#34;true&#34;</span>
  <span class=na>convertErrorsToExceptions=</span><span class=s>&#34;true&#34;</span>
  <span class=na>convertNoticesToExceptions=</span><span class=s>&#34;true&#34;</span>
  <span class=na>convertWarningsToExceptions=</span><span class=s>&#34;true&#34;</span>
  <span class=na>processIsolation=</span><span class=s>&#34;false&#34;</span>
  <span class=na>stopOnFailure=</span><span class=s>&#34;false&#34;</span><span class=nt>&gt;</span>
  <span class=nt>&lt;testsuites&gt;</span>
    <span class=nt>&lt;testsuite</span> <span class=na>name=</span><span class=s>&#34;Feature&#34;</span><span class=nt>&gt;</span>
      <span class=nt>&lt;directory</span> <span class=na>suffix=</span><span class=s>&#34;Test.php&#34;</span><span class=nt>&gt;</span>./tests/Feature<span class=nt>&lt;/directory&gt;</span>
    <span class=nt>&lt;/testsuite&gt;</span>

    <span class=nt>&lt;testsuite</span> <span class=na>name=</span><span class=s>&#34;Unit&#34;</span><span class=nt>&gt;</span>
      <span class=nt>&lt;directory</span> <span class=na>suffix=</span><span class=s>&#34;Test.php&#34;</span><span class=nt>&gt;</span>./tests/Unit<span class=nt>&lt;/directory&gt;</span>
    <span class=nt>&lt;/testsuite&gt;</span>
  <span class=nt>&lt;/testsuites&gt;</span>

  <span class=nt>&lt;filter&gt;</span>
    <span class=nt>&lt;whitelist</span> <span class=na>processUncoveredFilesFromWhitelist=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
      <span class=nt>&lt;directory</span> <span class=na>suffix=</span><span class=s>&#34;.php&#34;</span><span class=nt>&gt;</span>./app<span class=nt>&lt;/directory&gt;</span>
    <span class=nt>&lt;/whitelist&gt;</span>
  <span class=nt>&lt;/filter&gt;</span>
  
  <span class=nt>&lt;php&gt;</span>
    <span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;APP_ENV&#34;</span> <span class=na>value=</span><span class=s>&#34;testing&#34;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;CACHE_DRIVER&#34;</span> <span class=na>value=</span><span class=s>&#34;array&#34;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;SESSION_DRIVER&#34;</span> <span class=na>value=</span><span class=s>&#34;array&#34;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;QUEUE_DRIVER&#34;</span> <span class=na>value=</span><span class=s>&#34;sync&#34;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;DB_CONNECTION&#34;</span> <span class=na>value=</span><span class=s>&#34;sqlite&#34;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;DB_DATABASE&#34;</span> <span class=na>value=</span><span class=s>&#34;:memory:&#34;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;APP_DEBUG&#34;</span> <span class=na>value=</span><span class=s>&#34;false&#34;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;env</span> <span class=na>name=</span><span class=s>&#34;MAIL_DRIVER&#34;</span> <span class=na>value=</span><span class=s>&#34;log&#34;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;ini</span> <span class=na>name=</span><span class=s>&#34;memory_limit&#34;</span> <span class=na>value=</span><span class=s>&#34;512M&#34;</span> <span class=nt>/&gt;</span>
  <span class=nt>&lt;/php&gt;</span>

<span class=nt>&lt;/phpunit&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>我们只需要在内存中进行测试这样测试运行的速度会快一些，所以在 database 配置项目中我们将使用 <code>sqlite</code> 和<code>:memory:</code> (Sqlite 的内存数据库)。 将 <code>APP_DEBUG</code> 设置为 false 因为我们只需要对真实产生的错误进行断言。随着项目迭代测试用例会越来越多所以在将来你可能会需要增加 <code>memory_limit</code> 的值。</p>
<p><em><strong>译者注: APP_DEBUG 建议不要改成 false，这样有助于让我们的代码写的更严谨</strong></em></p>
<p>在 Laravel 里测试用例的基类 <code>TestCase</code> 中作一些测试相关的准备:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>Tests</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Foundation\Testing\DatabaseMigrations</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Foundation\Testing\DatabaseTransactions</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Foundation\Testing\TestCase</span> <span class=k>as</span> <span class=nx>BaseTestCase</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Faker\Factory</span> <span class=k>as</span> <span class=nx>Faker</span><span class=p>;</span>
<span class=sd>/**
</span><span class=sd> * Class TestCase
</span><span class=sd> * @package Tests
</span><span class=sd> * @runTestsInSeparateProcesses
</span><span class=sd> * @preserveGlobalState disabled
</span><span class=sd> */</span>
<span class=k>abstract</span> <span class=k>class</span> <span class=nc>TestCase</span> <span class=k>extends</span> <span class=nx>BaseTestCase</span>
<span class=p>{</span>
    <span class=k>use</span> <span class=nx>CreatesApplication</span><span class=p>,</span> <span class=nx>DatabaseMigrations</span><span class=p>,</span> <span class=nx>DatabaseTransactions</span><span class=p>;</span>
    <span class=k>protected</span> <span class=nv>$faker</span><span class=p>;</span>
    <span class=sd>/**
</span><span class=sd>     * Set up the test
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>setUp</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>parent</span><span class=o>::</span><span class=na>setUp</span><span class=p>();</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>faker</span> <span class=o>=</span> <span class=nx>Faker</span><span class=o>::</span><span class=na>create</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=sd>/**
</span><span class=sd>     * Reset the migrations
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>tearDown</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>artisan</span><span class=p>(</span><span class=s1>&#39;migrate:reset&#39;</span><span class=p>);</span>
        <span class=k>parent</span><span class=o>::</span><span class=na>tearDown</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们需要在 <code>TestCase</code> 中 use <code>DatabaseMigrations</code> 这个 trait 这样在执行每个测试用例时，迁移文件都会被执行一遍，于此同时在 <code>setUp()</code> 和 <code>tearDown()</code> 方法中我们需要执行创建测试环境和清理测试环境的相关操作。</p>
<p><em><strong>译者注： DatabaseMigrations 这个性状在测试 setUp 阶段会执行 migrate:refresh, 清除所有表然后重新执行迁移， 其实我们重置数据库后需要通过 seeder 来填充测试数据，所以我更倾向于不使用这个迁移而是在 TestCase 的 setUp 中 使用 migrate:refresh —seeder 来完成重置数据库和填充测试数据的操作</strong></em></p>
<h3 id=step2写测试用例>Step2：写测试用例</h3>
<p>就像鲍勃大叔说的那样：” 除非先写测试用例否则你没有权利去写实现代码（implementation）“。现在开始写我们的测试吧。（测试驱动开发的第一天原则)</p>
<blockquote>
<p>为了让 <code>phpunit</code> 识别测试，需要在测试方法上添加 / <strong>@test</strong> / 注释，或者是测试方法命名以 <code>test</code> 前缀开头。</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>Tests\Unit</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Tests\TestCase</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>ArticleApiUnitTest</span> <span class=k>extends</span> <span class=nx>TestCase</span>
<span class=p>{</span>
  <span class=k>public</span> <span class=k>function</span> <span class=nf>it_can_create_an_article</span><span class=p>()</span>
  <span class=p>{</span>
      <span class=nv>$data</span> <span class=o>=</span> <span class=p>[</span>
        <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>faker</span><span class=o>-&gt;</span><span class=na>sentence</span><span class=p>,</span>
        <span class=s1>&#39;content&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>faker</span><span class=o>-&gt;</span><span class=na>paragraph</span>
      <span class=p>];</span>

      <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>post</span><span class=p>(</span><span class=nx>route</span><span class=p>(</span><span class=s1>&#39;articles.store&#39;</span><span class=p>),</span> <span class=nv>$data</span><span class=p>)</span>
        <span class=o>-&gt;</span><span class=na>assertStatus</span><span class=p>(</span><span class=mi>201</span><span class=p>)</span>
        <span class=o>-&gt;</span><span class=na>assertJson</span><span class=p>(</span><span class=nv>$data</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>在这个测试中，测试了是否能创建一篇文章，我们断言了在创建文章成功后应用将返回 201 状态码还有预期的 JSON 数据。</p>
<p>在创建好我们的第一个测试后，执行 <code>phpunit</code> 或者 <code>vendor/bin/phpunit</code></p>
<p><img src=https://cdn.learnku.com/uploads/images/201912/21/6964/MWNcOIbLx3.png!large alt></p>
<p>当我们执行 <code>phpunit</code> 后测试结果显示失败了，这很正常因为在测试驱动开发中我们是先写测试程序，然后在编码实现功能的，所以在创建测试程序伊始测试程序执行后的结果就是测试失败 (测试驱动开发的第二条原则)。在测试中我们断言应用会返回 201 状态码但是却返回了 404，为什么？因为测试中请求的 URL 还未在应用中创建。这个 <code>api/v1/articles</code> POST 路由在应用中并不存在所以针对这个请求应用抛出了 404 错误。</p>
<p>接下来我们该作什么？</p>
<h3 id=step-3-在路由文件中创建测试里请求的-url>Step 3: 在路由文件中创建测试里请求的 URL</h3>
<p>让我们创建测试里请求的这个 URL 看看接下来会发生什么。</p>
<p>在你项目中的 <code>routes/api.php</code> 文件中创建这个 URL，在 api 中的路由其 URL 会自动加上 <code>/api</code> 前缀。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>use</span> <span class=nx>App\Http\Controllers\Api\ArticlesApiController</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Route</span><span class=p>;</span>
<span class=nx>Route</span><span class=o>::</span><span class=na>group</span><span class=p>([</span><span class=s1>&#39;prefix&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;v1&#39;</span><span class=p>],</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
  <span class=nx>Route</span><span class=o>::</span><span class=na>resource</span><span class=p>(</span><span class=s1>&#39;articles&#39;</span><span class=p>,</span> <span class=nx>ArticlesApiController</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></td></tr></table>
</div>
</div><p>你可以通过 <code>artisan</code> 命令创建这个资源控制器:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash>php artisan make:controller Api/ArticlesApiController —-resource
</code></pre></td></tr></table>
</div>
</div><p>也可以手动创建。POST 请求将会路由到 <code>ArticlesApiContorller</code> 的 <code>store</code> 方法</p>
<h3 id=step-4-debug-控制器>Step 4: DEBUG 控制器</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>ArticlesApiController</span> <span class=k>extends</span> <span class=nx>Controller</span> 
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>()</span> <span class=p>{</span>
        <span class=nx>dd</span><span class=p>(</span><span class=s1>&#39;success!&#39;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>现在让我们运行测试程序，看看测试程序是否能够访问到应用的这一部分，再次执行 <code>phpunit</code> 后返回结果如下：</p>
<p><img src=https://cdn.learnku.com/uploads/images/201912/21/6964/6wImak5GSq.png!large alt></p>
<p>执行后的结果在终端中提示出了字符串 <code>success!</code> 这意味着测试程序成功地访问到了创建文章的 API。</p>
<h3 id=step-5-验证你的输入>Step 5: 验证你的输入</h3>
<p>不要忘记验证将要存储到数据库中的数据，所以现在我们创建一个 <code>CreateArticleRequest</code> 类来控制输入数据的验证。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>ArticlesApiController</span> <span class=k>extends</span> <span class=nx>Controller</span> 
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>(</span><span class=nx>CreateArticleRequest</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>dd</span><span class=p>(</span><span class=s1>&#39;success!&#39;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>这个请求类包含了数据验证的规则:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>App\Articles\Requests</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Foundation\Http\FormRequest</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>CreateArticleRequest</span> <span class=k>extends</span> <span class=nx>FormRequest</span>
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>     * Transform the error messages into JSON
</span><span class=sd>     *
</span><span class=sd>     * @param array $errors
</span><span class=sd>     * @return \Illuminate\Http\JsonResponse
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>response</span><span class=p>(</span><span class=k>array</span> <span class=nv>$errors</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=nx>response</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>json</span><span class=p>(</span><span class=nv>$errors</span><span class=p>,</span> <span class=mi>422</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=sd>/**
</span><span class=sd>     * Determine if the user is authorized to make this request.
</span><span class=sd>     *
</span><span class=sd>     * @return bool
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>authorize</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=sd>/**
</span><span class=sd>     * Get the validation rules that apply to the request.
</span><span class=sd>     *
</span><span class=sd>     * @return array
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>rules</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=p>[</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;required&#39;</span><span class=p>],</span>
            <span class=s1>&#39;content&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span><span class=s1>&#39;required&#39;</span><span class=p>]</span>
        <span class=p>];</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>这是一个很好的验证数据的方式，因为之后我们可以新建另外一个测试程序来测试是否能捕获到这些验证错误，不过为了文章的精简我会在另外一篇单独的文章里来讲述如何创建捕获错误的测试程序。</p>
<h3 id=step-6-返回刚才创建的数据>Step 6: 返回刚才创建的数据</h3>
<p>记住在相应中应该返回指定的 JSON 结构这样我们就知道新建的数据成功存储到了数据库中。所以我们应该返回新创建的文章对象来满足我们上面创建的测试程序。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>ArticlesApiController</span> <span class=k>extends</span> <span class=nx>Controller</span> 
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>    * @param CreateArticleRequest $request
</span><span class=sd>    */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>(</span><span class=nx>CreateArticleRequest</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>Article</span><span class=o>::</span><span class=na>create</span><span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>all</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>你可能已经已经注意到了我们还没有创建 <code>Article</code> 这个类，接下来让我们来创建这个 Model。</p>
<h3 id=step-7-创建模型类>Step 7: 创建模型类</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>App\Articles</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Database\Eloquent\Model</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>Article</span> <span class=k>extends</span> <span class=nx>Model</span> 
<span class=p>{</span>
  <span class=k>protected</span> <span class=nv>$fillable</span> <span class=o>=</span> <span class=p>[</span>
    <span class=s1>&#39;title&#39;</span><span class=p>,</span>
    <span class=s1>&#39;content&#39;</span>
  <span class=p>];</span>

<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>在 Article 这个模型类中，你需要定义可填充和序列化时需要被隐藏的字段，一旦 Article 类定义好后，返回到控制器中导入这个 Article 类。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Articles\Article</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>ArticlesApiController</span> <span class=k>extends</span> <span class=nx>Controller</span> 
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>    * @param CreateArticleRequest $request
</span><span class=sd>    */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>(</span><span class=nx>CreateArticleRequest</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>Article</span><span class=o>::</span><span class=na>create</span><span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>all</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们差不多快要完成了！测试程序正确建立好了，URL 已经创建并且能够访问了，处理 URL 请求的控制器程序还有与数据表对应的模型类也都已经就绪了，现在让我们再试着执行一次 <code>phpunit</code> 命令。</p>
<h3 id=step-8-再次执行-phpunit-看看结果会怎么样135f2d>Step 8: 再次执行 phpunit 看看结果会怎么样<a href=#135f2d>#</a></h3>
<p><img src="https://user-gold-cdn.xitu.io/2018/7/16/164a33a1e816c0ef?w=800&h=300&f=png&s=151968" alt></p>
<p>它再一次失败了，这是好事还是坏事？可以说即是好事也是坏事。好的一方面是测试中断言会返回 201 状态码的 URL 的返回结果从之前的 404 错误变成了 500 错误 (如果你注意到了)。</p>
<p>不好的一方面是，它测试失败了我们需要让程序能够正确通过测试程序。当我们想要 debug 时我们想要看看应用程序到底抛出了什么错误。在 Laravel 测试程序中你只需要在发出 POST 请求后在调用 <code>dump()</code> 方法就能够看到应用程序返回的响应。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>Tests\Unit</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Tests\TestCase</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>ArticleApiUnitTest</span> <span class=k>extends</span> <span class=nx>TestCase</span>
<span class=p>{</span>
  <span class=k>public</span> <span class=k>function</span> <span class=nf>it_can_create_an_article</span><span class=p>()</span>
  <span class=p>{</span>
      <span class=nv>$data</span> <span class=o>=</span> <span class=p>[</span>
        <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>faker</span><span class=o>-&gt;</span><span class=na>sentence</span><span class=p>,</span>
        <span class=s1>&#39;content&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>faker</span><span class=o>-&gt;</span><span class=na>paragraph</span>
      <span class=p>];</span>

      <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>post</span><span class=p>(</span><span class=nx>route</span><span class=p>(</span><span class=s1>&#39;articles.store&#39;</span><span class=p>),</span> <span class=nv>$data</span><span class=p>)</span>
        <span class=o>-&gt;</span><span class=na>dump</span><span class=p>()</span>
        <span class=o>-&gt;</span><span class=na>assertStatus</span><span class=p>(</span><span class=mi>201</span><span class=p>)</span>
        <span class=o>-&gt;</span><span class=na>assertJson</span><span class=p>(</span><span class=nv>$data</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>你可以进一步 debug POST 请求后的输出，没准会得到更多你需要的信息，如果没有明确地给出提示发生了什么才导致的这个错误你可以去 Laravel 应用的日志文件 <strong>/storage/logs/laravel.log</strong> 里去查找错误信息。</p>
<p>现在让我们检查一下为什么会返回 500 错误。</p>
<p>Well， 因为我们在请求中正在尝试向一个不存在的数据表中写入数据所以才请求才会返回 500 错误。</p>
<h3 id=step-9-创建数据表>Step 9: 创建数据表</h3>
<p>执行下面的 laravel <code>artisan</code> 命令：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=nx>php</span> <span class=nx>artisan</span> <span class=nx>make</span><span class=o>:</span><span class=nx>migration</span> <span class=nx>create_articles_table</span> <span class=nx>–create</span><span class=o>=</span><span class=nx>articles</span>
</code></pre></td></tr></table>
</div>
</div><p>Laravel 会自动在 <code>/database/migrations</code> 里来创建迁移文件。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Schema</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Database\Schema\Blueprint</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Database\Migrations\Migration</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>CreateArticlesTable</span> <span class=k>extends</span> <span class=nx>Migration</span>
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>     * Run the migrations.
</span><span class=sd>     *
</span><span class=sd>     * @return void
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>up</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nx>Schema</span><span class=o>::</span><span class=na>create</span><span class=p>(</span><span class=s1>&#39;articles&#39;</span><span class=p>,</span> <span class=k>function</span> <span class=p>(</span><span class=nx>Blueprint</span> <span class=nv>$table</span><span class=p>)</span> <span class=p>{</span>
            <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>increments</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>);</span>
            <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>string</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>);</span>
            <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>text</span><span class=p>(</span><span class=s1>&#39;content&#39;</span><span class=p>);</span>
            <span class=nv>$table</span><span class=o>-&gt;</span><span class=na>timestamps</span><span class=p>();</span>
        <span class=p>});</span>
    <span class=p>}</span>
    <span class=sd>/**
</span><span class=sd>     * Reverse the migrations.
</span><span class=sd>     *
</span><span class=sd>     * @return void
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>down</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=nx>Schema</span><span class=o>::</span><span class=na>dropIfExists</span><span class=p>(</span><span class=s1>&#39;articles&#39;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>默认迁移创建的数据表中只有 <code>id</code> 和时间字段，你需要根据需求添加需要的字段。</p>
<h3 id=step-10-再一次运行-phpunit>Step 10: 再一次运行 phpunit</h3>
<p>我们快要大功告成了，文章开始时我们承诺了完成 TDD 有 11 个步骤，现在是步骤 10 了！你需要轻轻拍下你的被来鼓励自己已经走到了这里。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/7/16/164a33a1e8242eb9?w=800&h=304&f=png&s=151019" alt></p>
<p>Ooops, 又失败了？Whyyyyyyy? 如果你仔细检查的话你会发现你处在正确的轨道上！响应的状态码从 500 又变成 200。这意味着在发出 POST 请求后应用返回了执行成功的响应！这是没有匹配我们的需求，我们需要应用返回的响应状态码为 201 来让我们知道文章数据已经被正确写入到了数据库中。所以我们只需要修改一下我们的控制器程序为:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>
<span class=k>namespace</span> <span class=nx>App\Http\Controllers\Api</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Articles\Article</span><span class=p>;</span>
<span class=k>class</span> <span class=nc>ArticlesApiController</span> <span class=k>extends</span> <span class=nx>Controller</span> 
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>    * @param CreateArticleRequest $request
</span><span class=sd>    */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>store</span><span class=p>(</span><span class=nx>CreateArticleRequest</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>response</span><span class=p>(</span><span class=nx>Article</span><span class=o>::</span><span class=na>create</span><span class=p>(</span><span class=nv>$request</span><span class=o>-&gt;</span><span class=na>all</span><span class=p>()),</span> <span class=mi>201</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=step-11-运行-phpunit-然后祈祷一切会好b82507>Step 11: 运行 phpunit 然后祈祷一切会好<a href=#b82507>#</a></h3>
<p><img src=https://cdn.learnku.com/uploads/images/201912/21/6964/8KP55xVu5V.png!large alt></p>
<p>恭喜大功告成！你成功让程序通过了测试，这就是测试驱动开发的第三条原则。</p>
<p>这就是测试驱动开发 (TDD) 在 Laravel 中的简单实现。还有其它的一些方法在这篇文章中没有来得及讲到，我在未来可能会那些，像是 <code>repository pattern</code> 等等。<code>repository pattern</code> 是 DDD (domain driven development) 领域驱动开发的最佳实践。</p>
<p>测试驱动开发还有很多方法这里没有设计到不过我觉得这篇文章已经足够让你开始试着在实践中应用测试驱动开发了。</p>
<p><em><strong>译者注</strong></em></p>
<p>通过文章总结起来测试驱动开发有三条原则：</p>
<ol>
<li>
<p>倡导先写测试程序，再编码实现功能。</p>
</li>
<li>
<p>测试程序创建伊始肯定会测试失败。</p>
</li>
<li>
<p>在让测试程序测试成功的过程中逐步编码实现功能</p>
</li>
</ol>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>Rogee</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2021-11-26
<a href=https://github.com/rogeecn/notes/commit/8dc87a73a3f2da82883c4dc2f9a7d61a70e53f9a title=post>(8dc87a7)</a>
</span>
</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/laravel/>Laravel</a>
<a href=/tags/testing/>Testing</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/composer-mirrors/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Composer 国内镜像</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/nginx-wechat-image-reverse-proxy/>
<span class="next-text nav-default">Nginx 微信图片反向代理</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<div id=gitalk-container></div>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css crossorigin=anonymous>
<script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js crossorigin=anonymous></script>
<script type=text/javascript>var gitalk=new Gitalk({id:'2021-11-26 16:19:29 \u002b0800 \u002b0800',title:'简单的 11 步在 Laravel 中实现测试驱动开发 ',clientID:'a76a97e7cc23e0e0b81c',clientSecret:'c2b70fdf4690b743838e85e01d904249470079c8',repo:'notes',owner:'rogeecn',admin:['rogeecn'],body:decodeURI(location.href)});gitalk.render('gitalk-container')</script>
<noscript>Please enable JavaScript to view the <a href=https://github.com/gitalk/gitalk>comments powered by gitalk.</a></noscript>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://github.com/rogeecn class="iconfont icon-github" title=github></a>
<a href=http://notes.711xd.com/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动
</span>
<span class=division>|</span>
<span class=theme-info>
主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<div class=busuanzi-footer>
<span id=busuanzi_container_site_pv> 本站总访问量 <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次 </span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv> 本站总访客数 <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> 人 </span>
</div>
<span class=copyright-year>
&copy;
2020 -
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>Rogee</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
</body>
</html>